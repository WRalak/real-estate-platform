generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


enum UserRole {
  ADMIN
  AGENT
  LANDLORD
  USER
}

enum AccountStatus {
  PENDING
  ACTIVE
  SUSPENDED
  REJECTED
}

enum PropertyType {
  HOUSE
  APARTMENT
  LAND
  COMMERCIAL
  VILLA
}

enum PropertyStatus {
  AVAILABLE
  RENTED
  SOLD
  PENDING
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

model User {
  id              String          @id @default(cuid())
  email           String          @unique
  name            String
  phone           String
  role            UserRole
  status          AccountStatus   @default(PENDING)
  image           String?
  emailVerified   DateTime?
  password        String
  bio             String?
  agencyName      String?
  licenseNumber   String?
  location        String?
  languages       String[]        @default([])
  
  // Relationships
  properties      Property[]
  bookings        Booking[]
  reviews         Review[]
  messages        Message[]
  notifications   Notification[]
  payments        Payment[]
  
  // Agent/Landlord specific
  experienceYears Int?           @default(0)
  specialties     String[]       @default([])
  rating          Float?         @default(0)
  totalReviews    Int?           @default(0)
  
  // Timestamps
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@map("users")
}

model Property {
  id              String          @id @default(cuid())
  title           String
  description     String
  price           Decimal
  type            PropertyType
  status          PropertyStatus  @default(AVAILABLE)
  
  // Location details
  address         String
  city            String
  region          String          // East Africa specific: Nairobi, Dar es Salaam, Kampala, etc.
  country         String          @default("Kenya")
  latitude        Float
  longitude       Float
  
  // Property details
  bedrooms        Int
  bathrooms       Int
  area            Decimal         // in square meters
  yearBuilt       Int?
  features        String[]        @default([])
  amenities       String[]        @default([])
  
  // Media
  images          String[]        @default([])
  videos          String[]        @default([])
  floorPlan       String?
  virtualTour     String?
  
  // Owner/Agent
  ownerId         String
  owner           User            @relation(fields: [ownerId], references: [id])
  agentId         String?
  agent           User?           @relation(fields: [agentId], references: [id])
  
  // AI Generated Fields
  aiDescription   String?
  aiPriceInsight  String?
  aiTags          String[]        @default([])
  
  // Relationships
  bookings        Booking[]
  reviews         Review[]
  views           PropertyView[]
  favorites       Favorite[]
  
  // Timestamps
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@map("properties")
  @@index([latitude, longitude])
  @@index([city, region])
}

model Booking {
  id              String          @id @default(cuid())
  propertyId      String
  property        Property        @relation(fields: [propertyId], references: [id])
  userId          String
  user            User            @relation(fields: [userId], references: [id])
  date            DateTime
  message         String?
  status          String          @default("pending") // pending, confirmed, cancelled
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@map("bookings")
}

model Review {
  id              String          @id @default(cuid())
  propertyId      String?
  property        Property?       @relation(fields: [propertyId], references: [id])
  agentId         String?
  agent           User?           @relation(fields: [agentId], references: [id])
  userId          String
  user            User            @relation(fields: [userId], references: [id])
  rating          Int
  comment         String
  aiModerated     Boolean         @default(false)
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@map("reviews")
}

model Message {
  id              String          @id @default(cuid())
  senderId        String
  sender          User            @relation(fields: [senderId], references: [id])
  receiverId      String
  receiver        User            @relation(fields: [receiverId], references: [id])
  propertyId      String?
  property        Property?       @relation(fields: [propertyId], references: [id])
  content         String
  aiTranslated    Boolean         @default(false)
  aiSummarized    Boolean         @default(false)
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@map("messages")
}

model Payment {
  id              String          @id @default(cuid())
  userId          String
  user            User            @relation(fields: [userId], references: [id])
  amount          Decimal
  currency        String          @default("KES")
  type            String          // subscription, property_posting, featured
  status          PaymentStatus   @default(PENDING)
  mpesaCode       String?
  stripeId        String?
  metadata        Json?
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@map("payments")
}

model Notification {
  id              String          @id @default(cuid())
  userId          String
  user            User            @relation(fields: [userId], references: [id])
  title           String
  message         String
  type            String          // booking, message, payment, system
  read            Boolean         @default(false)
  
  createdAt       DateTime        @default(now())
  
  @@map("notifications")
}

model Favorite {
  id              String          @id @default(cuid())
  userId          String
  user            User            @relation(fields: [userId], references: [id])
  propertyId      String
  property        Property        @relation(fields: [propertyId], references: [id])
  
  createdAt       DateTime        @default(now())
  
  @@unique([userId, propertyId])
  @@map("favorites")
}

model PropertyView {
  id              String          @id @default(cuid())
  propertyId      String
  property        Property        @relation(fields: [propertyId], references: [id])
  userId          String?
  user            User?           @relation(fields: [userId], references: [id])
  ipAddress       String?
  
  createdAt       DateTime        @default(now())
  
  @@map("property_views")
}

model AICache {
  id              String          @id @default(cuid())
  query           String
  response        Json
  type            String          // property_recommendation, price_prediction, etc.
  
  createdAt       DateTime        @default(now())
  expiresAt       DateTime
  
  @@map("ai_cache")
  @@index([query])
}